---
title: "PA1_template.Rmd"
author: "Kathryn Hegarty"
date: "9 October 2015"
output: html_document
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
summary(cars)
```

You can also embed plots, for example:

```{r, echo=FALSE}
plot(cars)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


#Reproducible research report on Activity Monitoring Data
===========================================================

##Loading required libraries and reading in the data
```{r}
library(plyr)
library(dplyr)
library(ggplot2)
rawdata <- read.csv("activity.csv")
fulldata <- rawdata
fulldata$date <- as.POSIXct(fulldata$date)
```

##What is the mean total number of steps taken per day?
```{r}
statsfunc <- function(fulldata){
  return(data.frame(
    Sumsteps = sum(fulldata$steps, na.rm = TRUE)))
}
sumstats <- ddply(fulldata, .(date), statsfunc)


qplot(date, Sumsteps, data=sumstats, geom="histogram", stat="identity")
```

```{r}
mean(sumstats$Sumsteps)
```

```{r}
median(sumstats$Sumsteps)
```

##What is the average daily activity pattern?
```{r}
meantimefunc <- function(fulldata){
  return(data.frame(
    meanIntervalSteps = mean(fulldata$steps, na.rm=TRUE)
  ))
}

meantime <- ddply(fulldata, .(interval), meantimefunc)
plot(meantime$interval, meantime$meanIntervalSteps, type = "l")
```

```{r}
head(meantime[order(meantime$meanIntervalSteps, decreasing = TRUE),])
```

##Imputing missing values
```{r}
sum(complete.cases(fulldata)==FALSE)
```

```{r}

imputedData <- data.frame()

for (i in 1:nrow(fulldata)){
  if (complete.cases(fulldata[i,1]) == FALSE){
    
    xx <- function(yy){
     zz <- filter(meantime, interval==yy)
     zz[1,2]
    }
    
    
    imputedData[i,1] = xx(fulldata[i,3])
  }
  
  else{
    imputedData[i,1] = fulldata[i,1]
  }
}

completeData <- fulldata
completeData[,1] <- imputedData

```

```{r}
statsfunc <- function(completeData){
  return(data.frame(
    Sumsteps = sum(completeData$steps)))
}
CompleteSteps <- ddply(completeData, .(date), statsfunc)


qplot(date, Sumsteps, data=CompleteSteps, geom="histogram", stat="identity")
```

```{r}
mean(CompleteSteps$Sumsteps)
```

```{r}
median(CompleteSteps$Sumsteps)
```


##Are there differences in activity patterns between weekdays and weekends?
```{r}
fulldata$day <- weekdays(fulldata$date)
fulldata$week <- ifelse(fulldata$day == "Saturday" | fulldata$day == "Sunday","Weekend", "Weekday")
```

```{r}
weekday <- filter(completeData, week=="Weekday")
weekend <- filter(completeData, week=="Weekend")

weekdayfunc <- function(weekday){
  return(data.frame(
    meansteps = mean(weekday$steps, na.rm = TRUE)))
}

weekendfunc <- function(weekend){
  return(data.frame(
    meansteps = mean(weekend$steps, na.rm = TRUE)))
}

weekdaystats <- ddply(weekday, .(interval, week), weekdayfunc)
weekendstats <- ddply(weekend, .(interval, week), weekendfunc)
weekstats <- rbind(weekdaystats, weekendstats)
weekstats$week <- as.factor(weekstats$week)

qplot(interval, meansteps, data=weekstats) + geom_line() + ylab("Number of steps") + facet_wrap(~ week, ncol=1)
